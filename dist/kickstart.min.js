/* kickstart 0.2.x (nightly) (c) http://w2ui.com/kickstart, vitmalina@gmail.com */

var kickStart=function(){var app={_conf:{name:"unnamed",baseURL:"",cache:!1,modules:{},verbose:!0},define:define,require:require,register:register};return window.app||(window.app=app),app;function define(n,t){function a(e){for(var r in e)Array.isArray(e[r].assets)?(app._conf.modules.hasOwnProperty(r)&&app._conf.verbose&&console.log("ERROR: module "+r+" is already registered."),app._conf.modules[r]=$.extend({assets:{}},e[r],{ready:!1,files:{}})):a(e[r])}"string"==typeof n?$.ajax({url:app._conf.baseURL+n,dataType:"text",cache:app._conf.cache,success:function(e,r,o){if("success"==r){try{n=JSON.parse(e)}catch(e){return void(app._conf.verbose&&console.log('ERROR: not valid JSON file  "'+n+'".\n'+e))}a(n),"function"==typeof t&&t()}else app._conf.verbose&&console.log('ERROR: error while loading module definition from "'+n+'".')},error:function(e,r,o){app._conf.verbose&&console.log('ERROR: error while loading module definition from "'+n+'".')}}):(a(n),"function"==typeof t&&t())}function register(e,r){if(app.hasOwnProperty(e))return app._conf.verbose&&console.log("ERROR: Namespace "+e+" is already registered"),!1;if(!app._conf.modules.hasOwnProperty(e))return app._conf.verbose&&console.log("ERROR: Namespace "+e+" is not defined, first define it with kickStart.define"),!1;var o=app._conf.modules[e];app[e]=r(o.files,o),app._conf.modules[e].ready=!0}function require(names,callBack){$.isArray(names)||(names=[names]);var modCount=names.length,failed=!1,promise={ready:function(e){return promise._ready=e,promise},fail:function(e){return promise._fail=e,promise},done:function(e){return promise._done=e,promise},always:function(e){return promise._always=e,promise}};return setTimeout(function(){for(var n in names){var name=names[n];void 0!==app[name]?(modCount--,isFinished()):void 0===app._conf.modules[name]?app._conf.verbose&&console.log("ERROR: module "+name+" is not defined."):function(name){getFiles(app._conf.modules[name].assets.concat([app._conf.modules[name].start]),function(files){var start=files[app._conf.modules[name].start];delete files[app._conf.modules[name].start],app._conf.modules[name].files=files,app._conf.modules[name].ready=!0,eval(start),"function"==typeof promise._ready&&promise._ready(app._conf.modules[name]),modCount--,isFinished()})}(name)}},1),promise;function isFinished(){0==modCount&&(!0!==failed&&("function"==typeof promise._done&&promise._done(app._conf.modules[name]),"function"==typeof callBack&&callBack()),"function"==typeof promise._always&&promise._always())}}function getFiles(t,e){var a,i={},r=t.length;for(a in t)!function(){var n=t[a],e=$('script[path="'+n+'"]');0<e.length?(i[n]=e.html(),s()):$.ajax({url:app._conf.baseURL+n,dataType:"text",cache:app._conf.cache,success:function(e,r,o){"success"==r?(i[n]=o.responseText,s()):app._conf.verbose&&console.log("ERROR: error while getting a file "+n+".")},error:function(e,r,o){"error"==r?app._conf.verbose&&console.log("ERROR: failed to load "+t[a]+"."):(app._conf.verbose&&console.log('ERROR: file "'+t[a]+'" is loaded, but with a parsing error(s) in line '+o.line+": "+o.message),i[n]=xhr.responseText,s())}})}();function s(){--r<=0&&e(i)}}}();kickStart.define({route:{assets:[]}}),kickStart.register("route",function(){var v=kickStart,y={},_={};window.addEventListener?window.addEventListener("hashchange",R,!1):window.attachEvent("onhashchange",R);var e={init:function(e){""===o()?r(e):R()},add:function(e,r){if("object"==typeof e){for(var o in e){var n=String("/"+o).replace(/\/{2,}/g,"/");y[n]=e[o]}return v.route}if(e=String("/"+e).replace(/\/{2,}/g,"/"),"function"==typeof v.route.trigger){var t=v.route.trigger({phase:"before",type:"add",target:"self",route:e,handler:r});if(!0===t.isCancelled)return!1}y[e]=r,"function"==typeof v.route.trigger&&v.route.trigger($.extend(t,{phase:"after"}));return v.route},remove:function(e){if(e=String("/"+e).replace(/\/{2,}/g,"/"),"function"==typeof v.route.trigger){var r=v.route.trigger({phase:"before",type:"remove",target:"self",route:e,handler:handler});if(!0===r.isCancelled)return!1}delete y[e],delete _[e],"function"==typeof v.route.trigger&&v.route.trigger($.extend(r,{phase:"after"}));return v.route},go:r,set:function(e){return e=String("/"+e).replace(/\/{2,}/g,"/"),window.history.replaceState({},document.title,"#"+e),v.route},get:o,info:function(){var e,r=[],o=!1,n=window.location.hash.substr(1).replace(/\/{2,}/g,"/");""==n&&(n="/");for(e in _){var t={},a=_[e].path.exec(n);if(null!=a){o||-1!==e.indexOf("*")||(o=!0);var i,s=1;for(i in _[e].keys)t[_[e].keys[i].name]=a[s],s++;r.push({name:e,path:n,params:t})}}return r},process:R,list:function(){w();var e,r={};for(e in y){var o,n=_[e].keys,t=[];for(o in n)t.push(n[o].name);r[e]=t}return r},onAdd:null,onRemove:null,onRoute:null};return"undefined"!=typeof w2utils&&$.extend(e,w2utils.event,{handlers:[]}),e;function r(e){return e=String("/"+e).replace(/\/{2,}/g,"/"),window.history.replaceState({},document.title,"#"+e),R(),v.route}function o(){return window.location.hash.substr(1).replace(/\/{2,}/g,"/")}function R(){w();var r=window.location.hash.substr(1).replace(/\/{2,}/g,"/");""==r&&(r="/");var e,o=!1,n=!1,t=!1;for(e in _){var a={},i=_[e].path.exec(r);if(null!=i){o=!0,n||-1!==e.indexOf("*")||(n=!0);var s,f=1;for(s in _[e].keys)a[_[e].keys[s].name]=i[f],f++;if("function"==typeof v.route.trigger)if(!0===(p=v.route.trigger({phase:"before",type:"route",target:"self",route:e,params:a})).isCancelled)return!1;y[e]({name:e,path:r,params:a},a);"function"==typeof v.route.trigger&&v.route.trigger($.extend(p,{phase:"after"}));var u=window.location.hash.substr(1).replace(/\/{2,}/g,"/");if(r!==u)return}}var c,p,l=0,d=v._conf.modules,g=[];for(c in d){var m=d[c],h=m.route;null!=h&&("string"==typeof h&&(h=[h]),Array.isArray(h)&&h.forEach(function(e){e=e,m.routeRE=m.routeRE||{},null==m.routeRE[e]&&(m.routeRE[e]=w(e)),!m.ready&&e&&m.routeRE[e].path.exec(r)&&-1==g.indexOf(c)&&(v._conf.verbose&&console.log('ROUTER: Auto Load Module "'+c+'"'),t=!0,l++,g.push(c),v.require(c).done(function(){l--,v._conf.modules[c]&&0===l&&R()}))}))}if(t||n||!v._conf.verbose||console.log('ROUTER: Exact route for "'+r+'" not found'),!o){if("function"==typeof v.route.trigger)if(!0===(p=v.route.trigger({phase:"before",type:"error",target:"self",hash:r})).isCancelled)return!1;!t&&v._conf.verbose&&console.log('ROUTER: Wild card route for "'+r+'" not found'),"function"==typeof v.route.trigger&&v.route.trigger($.extend(p,{phase:"after"}))}}function w(e){if(null!=e)return r(e);for(var e in y)_[e]||(_[e]=r(e));function r(e){var i=[],e=e.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,r,o,n,t,a){return i.push({name:n,optional:!!a}),r=r||"",(a?"":r)+"(?:"+(a?r:"")+(o||"")+(t||(o?"([^/.]+?)":"([^/]+?)"))+")"+(a||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return{path:new RegExp("^"+e+"$","i"),keys:i}}}});